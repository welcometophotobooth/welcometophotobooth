<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Instant Polaroid Photobooth</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background-color: #f0f0f0;
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            text-align: center;
        }
        
        .container {
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            padding: 30px;
            max-width: 600px;
            width: 90%;
        }
        
        h1 {
            color: #333;
            margin-bottom: 20px;
        }
        
        .section {
            display: none;
        }
        
        .section.active {
            display: block;
            animation: fadeIn 0.5s;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        button {
            background-color: #ff6b6b;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
            margin: 10px;
            transition: background-color 0.3s;
        }
        
        button:hover {
            background-color: #ff5252;
        }
        
        .qr-code {
            width: 200px;
            height: 200px;
            margin: 20px auto;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .qr-code img {
            max-width: 100%;
            max-height: 100%;
        }
        
        .timer {
            font-size: 72px;
            font-weight: bold;
            color: #ff6b6b;
            margin: 20px 0;
        }
        
        .photo-preview {
            width: 100%;
            height: 300px;
            background-color: #333;
            margin: 20px 0;
            position: relative;
            overflow: hidden;
        }
        
        .taken-photos {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            margin: 20px 0;
        }
        
        .thumbnail {
            width: 120px;
            height: 120px;
            background-color: #555;
            margin: 5px;
            background-size: cover;
            background-position: center;
        }
        
        .shape-options {
            display: flex;
            justify-content: center;
            margin: 20px 0;
        }
        
        .shape-option {
            width: 100px;
            height: 130px;
            margin: 0 10px;
            border: 2px solid #ddd;
            cursor: pointer;
            transition: border-color 0.3s;
        }
        
        .shape-option.selected {
            border-color: #ff6b6b;
        }
        
        .classic {
            border-radius: 5px;
            background-color: white;
        }
        
        .rounded {
            border-radius: 15px;
            background-color: white;
        }
        
        .heart {
            background-color: white;
            position: relative;
            transform: scale(0.8);
        }
        
        .heart:before, .heart:after {
            content: "";
            position: absolute;
            width: 50px;
            height: 80px;
            background-color: white;
            border-radius: 50px 50px 0 0;
        }
        
        .heart:before {
            left: 50px;
            transform: rotate(-45deg);
            transform-origin: 0 100%;
            border: 2px solid #ddd;
            border-right: none;
            border-bottom: none;
        }
        
        .heart:after {
            left: 0;
            transform: rotate(45deg);
            transform-origin: 100% 100%;
            border: 2px solid #ddd;
            border-left: none;
            border-bottom: none;
        }
        
        .progress-container {
            width: 100%;
            height: 10px;
            background-color: #f0f0f0;
            border-radius: 5px;
            margin: 20px 0;
        }
        
        .progress-bar {
            height: 100%;
            background-color: #ff6b6b;
            border-radius: 5px;
            width: 0%;
            transition: width 0.5s;
        }
        
        #video {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        #canvas {
            display: none;
        }
        
        /* Payment method styles */
        .payment-methods {
            display: flex;
            flex-direction: column;
            margin: 20px 0;
            gap: 15px;
        }
        
        .payment-method {
            display: flex;
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 10px;
            cursor: pointer;
            transition: border-color 0.3s;
            align-items: center;
        }
        
        .payment-method:hover {
            border-color: #ff6b6b;
        }
        
        .payment-method.selected {
            border-color: #ff6b6b;
            background-color: rgba(255, 107, 107, 0.1);
        }
        
        .payment-method-icon {
            width: 50px;
            height: 30px;
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
            margin-right: 15px;
        }
        
        .card-input {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 20px;
        }
        
        .card-input input {
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
        }
        
        .card-row {
            display: flex;
            gap: 10px;
        }
        
        .card-row input {
            flex: 1;
        }
        
        .error-message {
            color: #ff3333;
            margin-top: 5px;
            font-size: 14px;
            display: none;
        }
        
        @media print {
            body * {
                visibility: hidden;
            }
            
            .print-only, .print-only * {
                visibility: visible;
            }
            
            .print-only {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
            }
        }
        
        .print-preview {
            display: none;
        }
        
        .print-only {
            padding: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div id="welcome" class="section active">
            <h1>Instant Polaroid Photobooth</h1>
            <p>Capture your special moments and get instant polaroid prints!</p>
            <p>Perfect for couples, families, friends, and everyone!</p>
            <button id="get-started">GET STARTED</button>
        </div>
        
        <div id="payment" class="section">
            <h1>Select Payment Method</h1>
            <p>Choose how you would like to pay</p>
            <p>Price: $5.00 for 4 photos</p>
            
            <div class="payment-methods">
                <div class="payment-method" data-method="card">
                    <div class="payment-method-icon" style="background-image: url('/api/placeholder/50/30');"></div>
                    <div>Credit/Debit Card</div>
                </div>
                <div class="payment-method" data-method="qrcode">
                    <div class="payment-method-icon" style="background-image: url('/api/placeholder/50/30');"></div>
                    <div>Scan QR Code</div>
                </div>
            </div>
            
            <div id="card-payment-form" style="display: none;">
                <div class="card-input">
                    <input type="text" id="card-number" placeholder="Card Number" maxlength="19">
                    <div class="error-message" id="card-number-error">Please enter a valid card number</div>
                    
                    <input type="text" id="card-name" placeholder="Cardholder Name">
                    <div class="error-message" id="card-name-error">Please enter cardholder name</div>
                    
                    <div class="card-row">
                        <input type="text" id="expiry-date" placeholder="MM/YY" maxlength="5">
                        <input type="password" id="cvv" placeholder="CVV" maxlength="4">
                    </div>
                    <div class="error-message" id="expiry-error">Please enter a valid expiration date</div>
                    <div class="error-message" id="cvv-error">Please enter a valid CVV</div>
                </div>
                <button id="process-card-payment">Process Payment</button>
            </div>
            
            <div id="qr-payment" style="display: none;">
                <div class="qr-code">
                    <img src="qr-code.jpg" alt="Payment QR Code" onerror="this.src='/api/placeholder/200/200'; this.onerror=null;">
                </div>
                <p>Scan with your mobile payment app</p>
                <button id="verify-qr-payment">I've Completed Payment</button>
            </div>
            
            <div id="payment-processing" style="display: none;">
                <div class="progress-container">
                    <div class="progress-bar" id="payment-progress"></div>
                </div>
                <p id="payment-status">Processing payment...</p>
            </div>
            
            <button id="simulate-payment" style="display: none;">Simulate Payment (For Demo)</button>
        </div>
        
        <div id="camera-setup" class="section">
            <h1>Get Ready!</h1>
            <p>Your photoshoot will begin shortly.</p>
            <p>Please position yourself in front of the camera.</p>
            <div class="photo-preview">
                <video id="video" autoplay></video>
            </div>
            <canvas id="canvas"></canvas>
            <button id="ready-btn">I'M READY</button>
        </div>
        
        <div id="photo-timer" class="section">
            <h1>Smile!</h1>
            <div class="photo-preview">
                <video id="timer-video" autoplay></video>
            </div>
            <div class="timer" id="countdown">15</div>
            <p>Photo <span id="photo-count">1</span> of 4</p>
        </div>
        
        <div id="photos-review" class="section">
            <h1>Your Photos</h1>
            <p>Here are your 4 beautiful shots!</p>
            <div class="taken-photos" id="photo-thumbnails"></div>
        </div>
        
        <div id="shape-selection" class="section">
            <h1>Choose Your Polaroid Style</h1>
            <p>Select the shape you'd like for your prints</p>
            <div class="shape-options">
                <div class="shape-option classic selected" data-shape="classic">
                    <p>Classic</p>
                </div>
                <div class="shape-option rounded" data-shape="rounded">
                    <p>Rounded</p>
                </div>
                <div class="shape-option heart" data-shape="heart">
                    <p>Heart</p>
                </div>
            </div>
            <button id="confirm-shape">CONFIRM SELECTION</button>
        </div>
        
        <div id="printing" class="section">
            <h1>Printing Your Photos</h1>
            <p>Please wait while we print your polaroids...</p>
            <div class="progress-container">
                <div class="progress-bar" id="print-progress"></div>
            </div>
            <p id="print-status">Preparing to print...</p>
        </div>
        
        <div id="complete" class="section">
            <h1>All Done!</h1>
            <p>Your polaroids have been printed!</p>
            <p>Don't forget to pick them up from the tray.</p>
            <p>Thank you for using our Photobooth!</p>
            <button id="start-over">START OVER</button>
        </div>
        
        <div id="print-area" class="print-only">
            <div id="polaroid-prints"></div>
        </div>
    </div>

    <script>
        // DOM Elements
        const sections = {
            welcome: document.getElementById('welcome'),
            payment: document.getElementById('payment'),
            cameraSetup: document.getElementById('camera-setup'),
            photoTimer: document.getElementById('photo-timer'),
            photosReview: document.getElementById('photos-review'),
            shapeSelection: document.getElementById('shape-selection'),
            printing: document.getElementById('printing'),
            complete: document.getElementById('complete')
        };
        
        // Buttons
        const getStartedBtn = document.getElementById('get-started');
        const simulatePaymentBtn = document.getElementById('simulate-payment');
        const readyBtn = document.getElementById('ready-btn');
        const confirmShapeBtn = document.getElementById('confirm-shape');
        const startOverBtn = document.getElementById('start-over');
        
        // Payment elements
        const paymentMethods = document.querySelectorAll('.payment-method');
        const cardPaymentForm = document.getElementById('card-payment-form');
        const qrPayment = document.getElementById('qr-payment');
        const processCardPaymentBtn = document.getElementById('process-card-payment');
        const verifyQrPaymentBtn = document.getElementById('verify-qr-payment');
        const paymentProcessing = document.getElementById('payment-processing');
        const paymentProgress = document.getElementById('payment-progress');
        const paymentStatus = document.getElementById('payment-status');
        
        // Card input elements
        const cardNumber = document.getElementById('card-number');
        const cardName = document.getElementById('card-name');
        const expiryDate = document.getElementById('expiry-date');
        const cvv = document.getElementById('cvv');
        
        // Error message elements
        const cardNumberError = document.getElementById('card-number-error');
        const cardNameError = document.getElementById('card-name-error');
        const expiryError = document.getElementById('expiry-error');
        const cvvError = document.getElementById('cvv-error');
        
        // Other elements
        const countdown = document.getElementById('countdown');
        const photoCount = document.getElementById('photo-count');
        const thumbnails = document.getElementById('photo-thumbnails');
        const shapeOptions = document.querySelectorAll('.shape-option');
        const printProgress = document.getElementById('print-progress');
        const printStatus = document.getElementById('print-status');
        const polaroidPrints = document.getElementById('polaroid-prints');
        
        // Video elements
        const video = document.getElementById('video');
        const timerVideo = document.getElementById('timer-video');
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        
        // App state
        let currentSection = 'welcome';
        let photosTaken = [];
        let currentPhotoIndex = 0;
        let selectedShape = 'classic';
        let selectedPaymentMethod = null;
        let paymentVerified = false;
        let stream = null;
        
        // Show a specific section
        function showSection(sectionName) {
            document.querySelectorAll('.section').forEach(section => {
                section.classList.remove('active');
            });
            
            sections[sectionName].classList.add('active');
            currentSection = sectionName;
        }
        
        // Initialize camera
        async function initCamera() {
            try {
                stream = await navigator.mediaDevices.getUserMedia({ video: true });
                video.srcObject = stream;
                timerVideo.srcObject = stream;
                
                // Set canvas size to match video dimensions
                video.onloadedmetadata = () => {
                    canvas.width = video.videoWidth;
                    canvas.height = video.videoHeight;
                };
            } catch (err) {
                console.error('Error accessing camera:', err);
                alert('Unable to access camera. Please ensure you have given permission.');
            }
        }
        
        // Take a photo
        function takePhoto() {
            // Draw the current video frame to the canvas
            ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
            
            // Get the image data
            const imageData = canvas.toDataURL('image/jpeg');
            photosTaken.push(imageData);
            
            // Create thumbnail
            createThumbnail(imageData);
            
            currentPhotoIndex++;
            
            if (currentPhotoIndex < 4) {
                // Start timer for next photo
                photoCount.textContent = currentPhotoIndex + 1;
                startPhotoTimer();
            } else {
                // All photos taken, move to review
                showSection('photosReview');
            }
        }
        
        // Create a thumbnail for the taken photo
        function createThumbnail(imageData) {
            const thumbnail = document.createElement('div');
            thumbnail.className = 'thumbnail';
            thumbnail.style.backgroundImage = `url(${imageData})`;
            thumbnails.appendChild(thumbnail);
        }
        
        // Start the photo timer
        function startPhotoTimer() {
            let secondsLeft = 15;
            countdown.textContent = secondsLeft;
            
            const timer = setInterval(() => {
                secondsLeft--;
                countdown.textContent = secondsLeft;
                
                if (secondsLeft <= 0) {
                    clearInterval(timer);
                    takePhoto();
                }
            }, 1000);
        }
        
        // Create polaroid prints based on selected shape
        function createPolaroidPrints() {
            polaroidPrints.innerHTML = '';
            
            photosTaken.forEach((photo, index) => {
                const polaroid = document.createElement('div');
                polaroid.style.width = '300px';
                polaroid.style.height = '350px';
                polaroid.style.margin = '10px';
                polaroid.style.padding = '15px';
                polaroid.style.backgroundColor = 'white';
                polaroid.style.boxShadow = '0 5px 15px rgba(0,0,0,0.1)';
                
                // Apply shape styling
                if (selectedShape === 'classic') {
                    polaroid.style.borderRadius = '5px';
                } else if (selectedShape === 'rounded') {
                    polaroid.style.borderRadius = '20px';
                } else if (selectedShape === 'heart') {
                    // Heart shape is complex for actual printing
                    // This is a simplified representation
                    polaroid.style.borderRadius = '20px 20px 5px 5px';
                }
                
                const photoImg = document.createElement('img');
                photoImg.src = photo;
                photoImg.style.width = '100%';
                photoImg.style.height = '80%';
                photoImg.style.objectFit = 'cover';
                
                if (selectedShape === 'rounded') {
                    photoImg.style.borderRadius = '15px';
                }
                
                const caption = document.createElement('div');
                caption.textContent = `Photobooth - ${new Date().toLocaleDateString()}`;
                caption.style.marginTop = '10px';
                caption.style.textAlign = 'center';
                
                polaroid.appendChild(photoImg);
                polaroid.appendChild(caption);
                polaroidPrints.appendChild(polaroid);
            });
        }
        
        // Simulate printing process
        function simulatePrinting() {
            createPolaroidPrints();
            
            let progress = 0;
            const interval = setInterval(() => {
                progress += 5;
                printProgress.style.width = `${progress}%`;
                
                if (progress <= 25) {
                    printStatus.textContent = "Preparing photos...";
                } else if (progress <= 50) {
                    printStatus.textContent = "Applying effects...";
                } else if (progress <= 75) {
                    printStatus.textContent = "Printing...";
                } else if (progress < 100) {
                    printStatus.textContent = "Almost done...";
                } else {
                    clearInterval(interval);
                    printStatus.textContent = "Printing complete!";
                    
                    // Simulate actual printing
                    setTimeout(() => {
                        window.print();
                        showSection('complete');
                    }, 1000);
                }
            }, 200);
        }
        
        // Validate credit card number using Luhn algorithm
        function isValidCardNumber(number) {
            // Remove spaces and dashes
            const cardNum = number.replace(/[\s-]/g, '');
            
            // Check if the input only contains digits
            if (!/^\d+$/.test(cardNum)) return false;
            
            // Check length (most cards are 13-19 digits)
            if (cardNum.length < 13 || cardNum.length > 19) return false;
            
            // Luhn algorithm implementation
            let sum = 0;
            let doubleUp = false;
            
            for (let i = cardNum.length - 1; i >= 0; i--) {
                let digit = parseInt(cardNum.charAt(i));
                
                if (doubleUp) {
                    digit *= 2;
                    if (digit > 9) digit -= 9;
                }
                
                sum += digit;
                doubleUp = !doubleUp;
            }
            
            return sum % 10 === 0;
        }
        
        // Validate expiry date
        function isValidExpiryDate(expiry) {
            // Check format (MM/YY)
            if (!/^\d{2}\/\d{2}$/.test(expiry)) return false;
            
            const [month, year] = expiry.split('/').map(part => parseInt(part, 10));
            const currentDate = new Date();
            const currentYear = currentDate.getFullYear() % 100; // Get last two digits
            const currentMonth = currentDate.getMonth() + 1; // JavaScript months are 0-indexed
            
            // Check month validity
            if (month < 1 || month > 12) return false;
            
            // Check if card is not expired
            if (year < currentYear || (year === currentYear && month < currentMonth)) {
                return false;
            }
            
            return true;
        }
        
        // Validate CVV
        function isValidCVV(cvvCode) {
            // Most cards use 3-digit CVV, American Express uses 4-digit
            return /^\d{3,4}$/.test(cvvCode);
        }
        
        // Format card number with spaces
        function formatCardNumber(input) {
            const numberOnly = input.value.replace(/\D/g, '');
            const groups = numberOnly.match(/.{1,4}/g);
            if (groups) {
                input.value = groups.join(' ');
            } else {
                input.value = numberOnly;
            }
        }
        
        // Format expiry date
        function formatExpiryDate(input) {
            const numberOnly = input.value.replace(/\D/g, '');
            
            if (numberOnly.length > 2) {
                input.value = numberOnly.substring(0, 2) + '/' + numberOnly.substring(2, 4);
            } else {
                input.value = numberOnly;
            }
        }
        
        // Verify payment information
        function verifyCardPayment() {
            let isValid = true;
            
            // Reset error messages
            cardNumberError.style.display = 'none';
            cardNameError.style.display = 'none';
            expiryError.style.display = 'none';
            cvvError.style.display = 'none';
            
            // Validate card number
            if (!isValidCardNumber(cardNumber.value)) {
                cardNumberError.style.display = 'block';
                isValid = false;
            }
            
            // Validate cardholder name
            if (cardName.value.trim() === '') {
                cardNameError.style.display = 'block';
                isValid = false;
            }
            
            // Validate expiry date
            if (!isValidExpiryDate(expiryDate.value)) {
                expiryError.style.display = 'block';
                isValid = false;
            }
            
            // Validate CVV
            if (!isValidCVV(cvv.value)) {
                cvvError.style.display = 'block';
                isValid = false;
            }
            
            return isValid;
        }
        
        // Process payment
        function processPayment() {
            cardPaymentForm.style.display = 'none';
            qrPayment.style.display = 'none';
            paymentProcessing.style.display = 'block';
            
            let progress = 0;
            const interval = setInterval(() => {
                progress += 10;
                paymentProgress.style.width = `${progress}%`;
                
                if (progress < 40) {
                    paymentStatus.textContent = "Verifying payment details...";
                } else if (progress < 70) {
                    paymentStatus.textContent = "Processing transaction...";
                } else if (progress < 100) {
                    paymentStatus.textContent = "Finalizing payment...";
                } else {
                    clearInterval(interval);
                    paymentStatus.textContent = "Payment successful!";
                    paymentVerified = true;
                    
                    // Proceed to next step after payment
                    setTimeout(() => {
                        initCamera();
                        showSection('cameraSetup');
                    }, 1000);
                }
            }, 200);
        }
        
        // Event Listeners
        getStartedBtn.addEventListener('click', () => {
            showSection('payment');
        });
        
        simulatePaymentBtn.addEventListener('click', () => {
            paymentVerified = true;
            initCamera();
            showSection('cameraSetup');
        });
        
        // Select payment method
        paymentMethods.forEach(method => {
            method.addEventListener('click', () => {
                paymentMethods.forEach(m => m.classList.remove('selected'));
                method.classList.add('selected');
                selectedPaymentMethod = method.dataset.method;
                
                if (selectedPaymentMethod === 'card') {
                    cardPaymentForm.style.display = 'block';
                    qrPayment.style.display = 'none';
                } else if (selectedPaymentMethod === 'qrcode') {
                    cardPaymentForm.style.display = 'none';
                    qrPayment.style.display = 'block';
                }
                
                // Show simulation button for demo purposes
                simulatePaymentBtn.style.display = 'block';
            });
        });
        
        // Format card inputs
        cardNumber.addEventListener('input', () => formatCardNumber(cardNumber));
        expiryDate.addEventListener('input', () => formatExpiryDate(expiryDate));
        
        // Process card payment
        processCardPaymentBtn.addEventListener('click', () => {
            if (verifyCardPayment()) {
                processPayment();
            }
        });
        
        // Verify QR code payment
        verifyQrPaymentBtn.addEventListener('click', () => {
            // In a real app, this would check with a server
            // For demo, we simulate verification
            processPayment();
        });
        
        readyBtn.addEventListener('click', () => {
            if (paymentVerified) {
                showSection('photoTimer');
                startPhotoTimer();
            } else {
                alert('Payment verification required before proceeding.');
                showSection('payment');
            }
        });
        
        shapeOptions.forEach(option => {
            option.addEventListener('click', () => {
                shapeOptions.forEach(opt => opt.classList.remove('selected'));
                option.classList.add('selected');
                selectedShape = option.dataset.shape;
            });
        });
        
        confirmShapeBtn.addEventListener('click', () => {
            showSection('printing');
            simulatePrinting();
        });
        
        startOverBtn.addEventListener('click', () => {
            // Reset app state
            photosTaken = [];
            currentPhotoIndex = 0;
            thumbnails.innerHTML = '';
            paymentVerified = false;
            
            // Reset payment forms
            cardNumber.value = '';
            cardName.value = '';
            expiryDate.value = '';
            cvv.value = '';
            
            // Reset error messages
            cardNumberError.style.display = 'none';
            cardNameError.style.display = 'none';
            expiryError.style.display = 'none';
            cvvError.style.display = 'none';
            
            // Reset payment processing
            paymentProgress.style.width = '0%';
            
            // Hide payment sections
            cardPaymentForm.style.display = 'none';
            qrPayment.style.display = 'none';
            paymentProcessing.style.display = 'none';
            
            // Stop camera stream if active
            if (stream) {
                stream.getTracks().forEach(track => track.stop());
                stream = null;
            }
            
            showSection('welcome');
        });
    </script>

    <a href="legal.html">Legal Policies</a>

</body>
</html>
